
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>삿포로 여행 가계부</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #F3F8FB; /* 연한 하늘색 배경 */
        }
        h1 {
            text-align: center;
            color: #4A4A4A; /* 어두운 회색 텍스트 */
            background-color: #E6EEF4; /* 연한 파스텔 블루 */
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .day-section {
            margin-bottom: 20px;
            background-color: #FAF8F5; /* 연한 크림색 배경 */
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #DCE1E6; /* 연한 회색 테두리 */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        table, th, td {
            border: 1px solid #DCE1E6;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #B4C1CB; /* 연한 회색 */
            border-radius: 5px;
            background-color: #F9F9F9;
        }
        button {
            padding: 10px;
            background-color: #A7D6E3; /* 파스텔톤 하늘색 버튼 */
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
        }
        button:hover {
            background-color: #89C2D3; /* 버튼 호버 시 더 진한 파스텔톤 */
        }
        .delete-btn {
            background-color: #F28C8C; /* 연한 파스텔 레드 */
            color: white;
        }
        .delete-btn:hover {
            background-color: #E77A7A; /* 삭제 버튼 호버 시 */
        }
        .total-expense {
            font-weight: bold;
            text-align: right;
            color: #4A4A4A; /* 어두운 회색 텍스트 */
        }
        #overall-total {
            font-size: 1.5em;
            text-align: right;
            color: #4A4A4A;
            background-color: #E6EEF4;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            table, th, td {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>

<h1>삿포로 여행 가계부 (2024.10.12 - 16)</h1>

<div id="budgetContainer"></div>

<div id="overall-total"></div>

<script>
    const days = ['여행 전', '10월 12일', '10월 13일', '10월 14일', '10월 15일', '10월 16일'];
    const apiUrl = 'https://angry-pie-chive.glitch.me';  // Glitch 프로젝트의 URL

    function createDaySection(day) {
        const section = document.createElement('div');
        section.className = 'day-section';
        section.innerHTML = `
            <h2>${day}</h2>
            <table id="table-${day}">
                <thead>
                    <tr>
                        <th>항목</th>
                        <th>설명</th>
                        <th>금액 (₩)</th>
                        <th>삭제</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <div class="total-expense" id="total-${day}">일일 합계: 0 ₩</div>
            <button onclick="addRow('${day}')">항목 추가</button>
        `;
        return section;
    }

    function addRow(day, item = '', description = '', amount = '') {
        const table = document.getElementById(`table-${day}`).getElementsByTagName('tbody')[0];
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td><input type="text" placeholder="항목" value="${item}"></td>
            <td><input type="text" placeholder="설명" value="${description}"></td>
            <td><input type="number" placeholder="금액" value="${amount}" oninput="calculateTotal('${day}')"></td>
            <td><button class="delete-btn" onclick="deleteRow(this, '${day}')">삭제</button></td>
        `;
        table.appendChild(newRow);
        saveData();
    }

    function deleteRow(button, day) {
        const row = button.parentElement.parentElement;
        row.remove();
        calculateTotal(day);
        saveData();
    }

    function calculateTotal(day) {
        const table = document.getElementById(`table-${day}`).getElementsByTagName('tbody')[0];
        let total = 0;
        Array.from(table.getElementsByTagName('tr')).forEach(row => {
            const amount = row.getElementsByTagName('input')[2].value;
            if (amount) {
                total += parseInt(amount);
            }
        });
        document.getElementById(`total-${day}`).innerText = `일일 합계: ${total.toLocaleString()} ₩`;
        calculateOverallTotal();
    }

    function calculateOverallTotal() {
        let overallTotal = 0;
        days.forEach(day => {
            const totalText = document.getElementById(`total-${day}`).innerText;
            const dayTotal = parseInt(totalText.replace(/[^\d]/g, ''));
            overallTotal += dayTotal;
        });
        document.getElementById('overall-total').innerText = `총 경비: ${overallTotal.toLocaleString()} ₩`;
        saveData();
    }

    // 서버에 데이터를 저장하는 함수
    async function saveData() {
        const data = {};
        days.forEach(day => {
            const table = document.getElementById(`table-${day}`).getElementsByTagName('tbody')[0];
            const rows = Array.from(table.getElementsByTagName('tr')).map(row => {
                return {
                    item: row.getElementsByTagName('input')[0].value,
                    description: row.getElementsByTagName('input')[1].value,
                    amount: row.getElementsByTagName('input')[2].value
                };
            });
            data[day] = rows;
        });

        try {
            await fetch(`${apiUrl}/saveData`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ day: 'all', items: data })
            });
        } catch (error) {
            console.error('데이터 저장 실패:', error);
        }
    }

    // 서버에서 데이터를 불러오는 함수
    async function loadData() {
        try {
            const response = await fetch(`${apiUrl}/loadData`);
            const data = await response.json();

            days.forEach(day => {
                const dayData = data[day] || [];
                dayData.forEach(entry => {
                    addRow(day, entry.item, entry.description, entry.amount);
                });
                calculateTotal(day);
            });
        } catch (error) {
            console.error('데이터 불러오기 실패:', error);
        }
    }

    // 페이지 로드 시 각 날짜에 대한 섹션을 만들고 데이터를 로드합니다.
    const budgetContainer = document.getElementById('budgetContainer');

    days.forEach(day => {
        budgetContainer.appendChild(createDaySection(day));
    });

    loadData();

</script>

</body>
</html>
